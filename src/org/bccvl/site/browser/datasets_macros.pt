<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="plone.z3cform"
      tal:omit-tag="">

  <head></head>

  <body>

    <metal:block metal:define-macro="datasets_tabs">

      <ul id="datasets_tabs" class="formTabs">
          <li class="formTab">
            <a href="#"
               tal:define="selected python: 'selected' if view.__name__ == 'datasets_listing_view' else ''"
               tal:attributes="href string:${context/absolute_url};
                               class selected">My Datasets</a>
          </li>
          <li class="formTab">
            <a href="#"
               tal:define="selected python: 'selected' if view.__name__ == 'datasets_import_view' else ''"
               tal:attributes="href string:${context/absolute_url}/datasets_import_view;
                               class selected">Discover Dataset</a>
          </li>
          <li class="formTab">
            <a href="#"
               tal:define="selected python: 'selected' if view.__name__ == 'datasets_upload_view' else ''"
               tal:attributes="href string:${context/absolute_url}/datasets_upload_view;
                               class selected">Upload Dataset</a>
          </li>
        </ul>

    </metal:block>

    <!-- needs various values set:
         rowstyle ... 'odd', 'even'
         show_about ... boolean
         item ... item,
                  item_icon, item_url, item_wf_state_class,
                  item_type, item_type_class, item_type_title,
                  item_description, item_title_or_id,
                  item_creator, item_modified
         settings ... use_view_action, navigation_root_url
         tools ... pas_member, toLocalizedTime
         -->
    <metal:block metal:define-macro="datasets_listitem">
        <!-- Title -->
        <tr tal:attributes="class rowstyle">
        <td>
            <img width="16" height="16"
                 src="" alt=""
                 tal:condition="item_icon/url"
                 tal:attributes="src item_icon/url;
                                 alt item_icon/description;
                                 title item_icon/title;
                                 width item_icon/width;
                                 height item_icon/height;" />
            <a href="#"
               tal:attributes="href python: item_type in use_view_action and item_url+'/view' or item_url;
                               class string:$item_wf_state_class $item_type_class;
                               title item_description;"
               tal:content="item_title_or_id">Item Title</a>
        </td>
        <!-- Author -->
        <td tal:condition="show_about">
            <tal:name tal:condition="item_creator"
                      tal:define="author python:pas_member.info(item_creator)">
                <a href="#"
                   tal:attributes="href string:${navigation_root_url}/author/${item_creator}"
                   tal:content="author/name_or_id"
                   tal:omit-tag="not:author">Bob Dobalina</a>
            </tal:name>
        </td>
        <!-- Type -->
        <td tal:content="item_genre_title"
            i18n:translate="">Page</td>
        <!-- Modified -->
        <td tal:condition="show_about"
            tal:content="python:toLocalizedTime(item_modified,long_format=1)">August 16, 2001 at 23:35:59</td>
        <!-- job state -->
        <td tal:condition="show_about">
            <span tal:replace="item/job_state"></span>
        </td>
        <!-- Actions -->
        <!-- TODO: expects simple publication workflow
                   publish/retract -->
        <!-- TODO: change this to some sort of popup to let user change review_state
                   and show review_state here ... would need permissions again to check if link is available to user :(
             TODO: check review_state and permission ... need permission here
             TODO: indexing won't work as this is per user
         -->
        <td tal:define="action item_obj/dataset_tools/get_transition"
            tal:condition="show_about">
            <a href="#"
               tal:attributes="href string:${item_url}/dm/share"
               tal:condition="python: 'publish' in action">Share</a>
            <a href="#"
               tal:attributes="href string:${item_url}/dm/unshare"
               tal:condition="python: 'retract' in action">Un-share</a>
            <i tal:content="item/review_state"></i>
        </td>
        <!-- Download -->
        <td>
            <a href="#"
               tal:condition="python: item.job_state in ('COMPLETED', None, '')"
               tal:define="dlinfo item_obj/dataset_tools/get_download_info"
               tal:attributes="href dlinfo/url">Download</a>
        </td>
        </tr>
    </metal:block>
  </body>
</html>
